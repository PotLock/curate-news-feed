import { Link } from "@tanstack/react-router";

interface ReadingHeaderProps {
  feedId: string;
  categoryCount: number;
  uploadDate: string;
  authorName?: string;
}

// Function to get relative time display
const getRelativeTime = (dateString: string) => {
  const date = new Date(dateString);
  const now = new Date();
  const diffInMs = now.getTime() - date.getTime();
  const diffInDays = Math.floor(diffInMs / (1000 * 60 * 60 * 24));

  if (diffInDays === 0) return "Today";
  if (diffInDays === 1) return "Yesterday";
  if (diffInDays < 7) return `${diffInDays} Days ago`;
  if (diffInDays < 30) return `${Math.floor(diffInDays / 7)} Weeks ago`;
  if (diffInDays < 365) return `${Math.floor(diffInDays / 30)} Months ago`;
  return `${Math.floor(diffInDays / 365)} Years ago`;
};

export function ReadingHeader({
  feedId,
  categoryCount,
  uploadDate,
  authorName,
}: ReadingHeaderProps) {
  return (
    <div className="w-full flex max-w-[785px] items-center justify-between mb-8">
      {/* Close Button */}
      <Link
        to="/$feedId"
        params={{ feedId }}
        className="hover:opacity-70 transition-opacity"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="37"
          height="37"
          viewBox="0 0 37 37"
          fill="none"
        >
          <path
            d="M15.4631 13.8284C15.0115 13.3768 14.2794 13.3768 13.8279 13.8284C13.3763 14.2799 13.3763 15.012 13.8279 15.4636L16.8645 18.5002L13.8279 21.5367C13.3764 21.9883 13.3764 22.7204 13.8279 23.1719C14.2794 23.6234 15.0115 23.6234 15.4631 23.1719L18.4996 20.1353L21.5362 23.1719C21.9877 23.6234 22.7198 23.6234 23.1714 23.1719C23.6229 22.7203 23.6229 21.9882 23.1714 21.5367L20.1348 18.5002L23.1714 15.4636C23.6229 15.0121 23.6229 14.28 23.1714 13.8284C22.7198 13.3769 21.9877 13.3769 21.5362 13.8284L18.4996 16.865L15.4631 13.8284Z"
            fill="#1C274C"
          />
          <path
            fillRule="evenodd"
            clipRule="evenodd"
            d="M18.4997 1.92725C9.34671 1.92725 1.92676 9.34719 1.92676 18.5002C1.92676 27.6531 9.34671 35.0731 18.4997 35.0731C27.6526 35.0731 35.0726 27.6531 35.0726 18.5002C35.0726 9.34719 27.6526 1.92725 18.4997 1.92725ZM4.23926 18.5002C4.23926 10.6244 10.6239 4.23975 18.4997 4.23975C26.3755 4.23975 32.7601 10.6244 32.7601 18.5002C32.7601 26.376 26.3755 32.7606 18.4997 32.7606C10.6239 32.7606 4.23926 26.376 4.23926 18.5002Z"
            fill="#1C274C"
          />
        </svg>
      </Link>

      {/* Center Header Container */}
      <div className="reading-header-container">
        <div className="flex items-center px-[10px] py-[6px] gap-[10px]">
          {/* Categories Button */}
          <div className="flex items-center gap-[10px]">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="21"
              height="21"
              viewBox="0 0 21 21"
              fill="none"
            >
              <path
                fillRule="evenodd"
                clipRule="evenodd"
                d="M4.46084 2.54175C4.47385 2.54175 4.4869 2.54175 4.5 2.54175L16.2058 2.54175C16.7616 2.54172 17.2367 2.5417 17.6165 2.5896C18.0192 2.6404 18.4085 2.75449 18.7282 3.05445C19.0535 3.3597 19.1828 3.74055 19.2396 4.13679C19.2917 4.50078 19.2917 4.95339 19.2917 5.46973L19.2917 6.11685C19.2917 6.52394 19.2917 6.87587 19.2613 7.16934C19.2286 7.48513 19.1571 7.78141 18.9854 8.06586C18.8151 8.34817 18.5856 8.55308 18.3212 8.73678C18.0721 8.90983 17.7538 9.08899 17.3794 9.29971L14.9274 10.68C14.3692 10.9942 14.1749 11.1074 14.0451 11.22C13.7472 11.4787 13.5765 11.7658 13.4963 12.1254C13.462 12.2791 13.4583 12.4728 13.4583 13.0609L13.4583 15.3376C13.4584 16.0886 13.4584 16.7262 13.3811 17.2164C13.299 17.7376 13.1082 18.2375 12.6081 18.5503C12.1195 18.8559 11.5813 18.8279 11.0582 18.7036C10.5544 18.584 9.93356 18.3412 9.18863 18.05L9.11623 18.0217C8.7673 17.8853 8.46176 17.7659 8.21987 17.641C7.95991 17.5068 7.7185 17.3398 7.5338 17.0798C7.34701 16.817 7.27213 16.5351 7.23874 16.247C7.20828 15.9843 7.20831 15.6689 7.20834 15.3173L7.20834 13.0609C7.20834 12.4728 7.20463 12.2791 7.17035 12.1254C7.09017 11.7658 6.91952 11.4787 6.62153 11.22C6.49178 11.1074 6.29743 10.9942 5.73928 10.68L3.28725 9.29971C2.91291 9.089 2.59461 8.90983 2.34549 8.73678C2.08104 8.55308 1.85159 8.34817 1.68123 8.06586C1.50957 7.78141 1.43809 7.48513 1.40537 7.16934C1.37497 6.87587 1.37499 6.52394 1.375 6.11685L1.375 5.5123C1.375 5.49806 1.375 5.48387 1.375 5.46972C1.37496 4.95338 1.37493 4.50078 1.42709 4.13679C1.48387 3.74055 1.61313 3.3597 1.93848 3.05445C2.25819 2.75449 2.64746 2.6404 3.0502 2.5896C3.42994 2.5417 3.90505 2.54172 4.46084 2.54175ZM3.20663 3.82977C2.92859 3.86485 2.84017 3.92251 2.79376 3.96605C2.75299 4.00429 2.6992 4.07162 2.66445 4.3141C2.62651 4.57887 2.625 4.94065 2.625 5.5123V6.08715C2.625 6.53232 2.62578 6.81906 2.64872 7.04053C2.67009 7.24679 2.70677 7.34597 2.75145 7.42001C2.79742 7.49618 2.87375 7.58175 3.05861 7.71016C3.25338 7.84545 3.51946 7.99598 3.92494 8.22424L6.35247 9.59077C6.3752 9.60356 6.39758 9.61616 6.41964 9.62857C6.88523 9.8905 7.20232 10.0689 7.441 10.2761C7.9338 10.7039 8.24997 11.2236 8.39039 11.8534C8.45864 12.1595 8.45852 12.5027 8.45835 12.9872C8.45835 13.0114 8.45834 13.0359 8.45834 13.0609V15.2854C8.45834 15.6789 8.45931 15.9209 8.48042 16.1031C8.49952 16.2679 8.5296 16.3232 8.55275 16.3558C8.57799 16.3913 8.62797 16.4449 8.79336 16.5303C8.97037 16.6217 9.21424 16.7179 9.59936 16.8685C10.4002 17.1815 10.9389 17.3905 11.347 17.4875C11.7459 17.5822 11.8773 17.533 11.9453 17.4905C12.0019 17.4551 12.0894 17.3831 12.1464 17.0217C12.2065 16.6406 12.2083 16.103 12.2083 15.2854V13.0609C12.2083 13.0359 12.2083 13.0114 12.2083 12.9872C12.2082 12.5027 12.208 12.1595 12.2763 11.8534C12.4167 11.2236 12.7329 10.7039 13.2257 10.2761C13.4643 10.0689 13.7814 9.89051 14.247 9.62858C14.2691 9.61617 14.2915 9.60357 14.3142 9.59077L16.7417 8.22424C17.1472 7.99598 17.4133 7.84545 17.6081 7.71016C17.7929 7.58175 17.8693 7.49618 17.9152 7.42001C17.9599 7.34597 17.9966 7.24679 18.018 7.04053C18.0409 6.81906 18.0417 6.53232 18.0417 6.08715V5.5123C18.0417 4.94065 18.0402 4.57887 18.0022 4.3141C17.9675 4.07162 17.9137 4.00429 17.8729 3.96605C17.8265 3.92251 17.7381 3.86485 17.46 3.82977C17.1679 3.79292 16.7725 3.79175 16.1667 3.79175H4.5C3.89414 3.79175 3.49879 3.79292 3.20663 3.82977Z"
                fill="#27272A"
              />
            </svg>
            <span className="text-[#27272A] text-center font-inter text-sm font-medium leading-5">
              Categories
            </span>
            <div className="category-count-badge">
              <span className="text-[#27272A] font-inter text-xs font-medium leading-4">
                {categoryCount}
              </span>
            </div>
          </div>

          {/* Divider */}
          <div className="w-px h-6 bg-[#E5E5E5]"></div>

          {/* Upload Date */}
          <div className="flex items-center gap-[10px]">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="21"
              height="21"
              viewBox="0 0 21 21"
              fill="none"
            >
              <circle
                cx="10.8035"
                cy="10.6668"
                r="8.33333"
                stroke="#27272A"
                strokeWidth="1.5"
              />
              <path
                d="M10.8037 7.3335V10.6668L12.887 12.7502"
                stroke="#27272A"
                strokeWidth="1.5"
                strokeLinecap="round"
                strokeLinejoin="round"
              />
            </svg>
            <span className="text-[#27272A] text-center font-inter text-sm font-medium leading-5">
              {getRelativeTime(uploadDate)}
            </span>
          </div>

          {/* Divider */}
          <div className="w-px h-6 bg-[#E5E5E5]"></div>

          {/* Author */}
          <div className="flex items-center gap-[10px]">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 20 20"
              fill="none"
            >
              <circle
                cx="9.99984"
                cy="5.00008"
                r="3.33333"
                stroke="#27272A"
                strokeWidth="1.5"
              />
              <path
                d="M16.6668 14.5833C16.6668 16.6543 16.6668 18.3333 10.0002 18.3333C3.3335 18.3333 3.3335 16.6543 3.3335 14.5833C3.3335 12.5122 6.31826 10.8333 10.0002 10.8333C13.6821 10.8333 16.6668 12.5122 16.6668 14.5833Z"
                stroke="#27272A"
                strokeWidth="1.5"
              />
            </svg>
            <span className="text-[#27272A] text-center font-inter text-sm font-medium leading-5">
              {authorName || "Unknown"}
            </span>
          </div>

          {/* Divider */}
          <div className="w-px h-6 bg-[#E5E5E5]"></div>

          {/* Settings */}
          <div className="flex items-center">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 20 20"
              fill="none"
            >
              <circle
                cx="10"
                cy="10"
                r="2.5"
                stroke="#27272A"
                strokeWidth="1.5"
              />
              <path
                d="M11.471 1.79362C11.1648 1.66675 10.7765 1.66675 9.99991 1.66675C9.22334 1.66675 8.83505 1.66675 8.52877 1.79362C8.12039 1.96277 7.79593 2.28723 7.62678 2.69561C7.54956 2.88203 7.51934 3.09883 7.50751 3.41507C7.49013 3.87982 7.2518 4.30999 6.84904 4.54252C6.44628 4.77505 5.95458 4.76636 5.54341 4.54905C5.26362 4.40116 5.06076 4.31893 4.8607 4.2926C4.42245 4.2349 3.97924 4.35366 3.62855 4.62275C3.36554 4.82456 3.1714 5.16083 2.78311 5.83336C2.39483 6.50589 2.20069 6.84215 2.15741 7.17084C2.09972 7.60908 2.21848 8.0523 2.48757 8.40298C2.61039 8.56305 2.783 8.6976 3.05091 8.86594C3.44475 9.1134 3.69816 9.53496 3.69813 10.0001C3.69811 10.4652 3.44471 10.8867 3.05091 11.1341C2.78296 11.3025 2.61032 11.437 2.48748 11.5971C2.21839 11.9478 2.09964 12.391 2.15733 12.8293C2.2006 13.158 2.39475 13.4942 2.78303 14.1667C3.17132 14.8393 3.36546 15.1755 3.62847 15.3774C3.97915 15.6464 4.42237 15.7652 4.86062 15.7075C5.06066 15.6812 5.26352 15.599 5.54328 15.4511C5.95448 15.2338 6.44622 15.2251 6.849 15.4576C7.25178 15.6902 7.49013 16.1204 7.50751 16.5851C7.51934 16.9014 7.54956 17.1181 7.62678 17.3046C7.79593 17.7129 8.12039 18.0374 8.52877 18.2065C8.83505 18.3334 9.22334 18.3334 9.99991 18.3334C10.7765 18.3334 11.1648 18.3334 11.471 18.2065C11.8794 18.0374 12.2039 17.7129 12.373 17.3046C12.4503 17.1181 12.4805 16.9013 12.4923 16.5851C12.5097 16.1203 12.748 15.6902 13.1507 15.4576C13.5535 15.225 14.0453 15.2337 14.4565 15.451C14.7362 15.5989 14.9391 15.6811 15.1391 15.7075C15.5774 15.7651 16.0206 15.6464 16.3713 15.3773C16.6343 15.1755 16.8284 14.8392 17.2167 14.1667C17.605 13.4942 17.7991 13.1579 17.8424 12.8292C17.9001 12.391 17.7813 11.9478 17.5123 11.5971C17.3894 11.437 17.2168 11.3024 16.9489 11.1341C16.555 10.8866 16.3017 10.4651 16.3017 10C16.3017 9.53496 16.5551 9.11348 16.9489 8.86607C17.2168 8.6977 17.3895 8.56313 17.5123 8.40304C17.7814 8.05235 17.9002 7.60914 17.8425 7.17089C17.7992 6.84221 17.6051 6.50594 17.2168 5.83342C16.8285 5.16089 16.6344 4.82462 16.3713 4.6228C16.0207 4.35372 15.5774 4.23496 15.1392 4.29265C14.9392 4.31899 14.7363 4.40121 14.4565 4.54908C14.0453 4.76641 13.5536 4.7751 13.1508 4.54255C12.748 4.31 12.5097 3.8798 12.4923 3.41503C12.4805 3.09881 12.4503 2.88202 12.373 2.69561C12.2039 2.28723 11.8794 1.96277 11.471 1.79362Z"
                stroke="#27272A"
                strokeWidth="1.5"
              />
            </svg>
          </div>
        </div>
      </div>

      {/* Empty div for layout balance */}
      <div className="w-[37px]"></div>
    </div>
  );
}
